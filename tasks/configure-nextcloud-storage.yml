---
# nextcloud volume mounting and configuration

- name: "Ensure non-snap nextcloud data directory exists."
  file:
    path: "{{ nc_snap_nextcloud_data_dir }}"
    state: directory
    owner: "root"
    group: "root"

- name: "Temporarily disable nextcloud snap."
  command: "snap disable nextcloud"
  changed_when: false

- name: "Configure nextcloud to use non-snap data directory."
  lineinfile:
    path: "/var/snap/nextcloud/current/nextcloud/config/autoconfig.php"
    regexp: "^'directory'"
    create: false
    line: "'directory' => '{{ nc_snap_nextcloud_data_dir }}',"

- name: "Re-enable nextcloud snap."
  command: "snap enable nextcloud"
  changed_when: false
